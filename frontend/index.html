<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Book Finder ‚Äî Home</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Main stylesheet -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  
  <!-- NAVBAR -->
  <header class="nav">
    <div class="nav-inner container">
      <a class="logo" href="index.html">üìö <span class="logo-text">BookFinder</span></a>
      <nav class="nav-links">
        <a href="index.html">Home</a>
        <a href="history.html">History</a>
        <a href="login.html" class="btn small">Login</a>
        <a href="register.html" class="btn small ghost">Register</a>
      </nav>
    </div>
  </header>

  <!-- HERO / SEARCH -->
  <main class="hero container">
    <section class="hero-top">
      <h1 class="hero-title">Find your next favorite book</h1>
      <p class="hero-sub">Search millions of books ‚Äî see covers, authors, and related titles instantly.</p>

      <form id="searchForm" class="search-form" autocomplete="off">
        <!-- <input id="searchInput" type="search" placeholder="Try: Harry Potter, Pride and Prejudice..." />
        <button id="searchBtn" type="submit">Search</button> -->
        <input type="text" id="searchInput" placeholder="Search for books...">
<button onclick="searchBook()">Search</button>
       
      </form>

      <!-- Popular chips -->
      <div class="popular" id="popularList" aria-label="Popular books">
        <!-- JS will populate chips -->
      </div>
    </section>

    <!-- RESULTS + RELATED -->
    <section class="results-area">
      <div class="results-col">
        <h2 class="section-title">Search Results</h2>
        <div id="message" class="message"></div>
        <div id="results" class="cards-grid"></div>
        <div id="loadMoreWrap" class="load-more-wrap"></div>
      </div>

      <aside class="related-col">
        <h3 class="section-subtitle">Related suggestions</h3>
        <div id="related" class="related-grid"></div>
        <h3 class="section-subtitle mt-6">Popular right now</h3>
        <div id="popularRightNow" class="popular-rightnow"></div>
      </aside>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="container">
      <p>Made with ‚ô• for reading. | Open Library API</p>
    </div>
  </footer>

  <!-- Script -->
  <script src="script.js"></script>

    <!-- Script -->
<script>
  // Save book to backend history
  async function saveToHistory(book) {
    const token = localStorage.getItem("token");
    if (!token) {
      alert("‚ö†Ô∏è Please login to save books to your history!");
      return;
    }

    try {
      const response = await fetch("http://localhost:5000/history", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": token
        },
        body: JSON.stringify(book)
      });

      const data = await response.json();
      if (response.ok) {
        alert(`‚úÖ "${book.title}" added to your history!`);
      } else {
        alert(data.error || "‚ùå Could not save book to history");
      }
    } catch (err) {
      console.error("Error saving history:", err);
      alert("Server error while saving history!");
    }
  }

  // Search function using Open Library API
  async function searchBook() {
    const query = document.getElementById("searchInput").value.trim();
    if (!query) return;

    const response = await fetch(`https://openlibrary.org/search.json?title=${query}`);
    const data = await response.json();

    const resultsContainer = document.getElementById("results");
    resultsContainer.innerHTML = "";

    if (!data.docs.length) {
      resultsContainer.innerHTML = "<p>No books found!</p>";
      return;
    }

    data.docs.slice(0, 10).forEach(book => {
      const title = book.title || "No title";
      const author = book.author_name ? book.author_name.join(", ") : "Unknown";
      const coverId = book.cover_i;
      const img = coverId
        ? `https://covers.openlibrary.org/b/id/${coverId}-M.jpg`
        : "https://via.placeholder.com/200x300?text=No+Cover";

      // Create a book card
      const bookCard = document.createElement("div");
      bookCard.classList.add("book-card");
      bookCard.innerHTML = `
        <img src="${img}" alt="${title}">
        <h3>${title}</h3>
        <p>By ${author}</p>
      `;

      // Save to MongoDB when clicked
      bookCard.addEventListener("click", () => {
        saveToHistory({ title, author, img });
      });

      resultsContainer.appendChild(bookCard);
    });
  }
</script>


</body>
</html>

